import cube             from 'cube-js';

var gaAgent = function() {
  chrome.runtime.sendMessage({
    action: 'ga',
    data: cube.Array.toArray(arguments)
  });
}

cube.mix(gaAgent, {
  auto: function() {
    document.body.addEventListener('click', function(e){
      if(e.target && e.target.hasAttribute('data-ga')) {

        // you can add `data-ga="event category|event action[|event lable]"` attribe on an element
        var data = e.target.getAttribute('data-ga');
        var args = data.split('|');
        if (args.length >= 2) {
          args.unshift('event');
          args.unshift('send');
          gaAgent.apply(null, args);
        }
      }
    });
  }
});

module.exports = gaAgent;
